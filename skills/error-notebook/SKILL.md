---
name: error-notebook
description: >
  浏览对话历史，识别错误并以日记式追加方式记录到 docs/error-notebook-<项目名>.md。支持识别重复修改超过3次的"顽疾"，并提供详细记录。当文档记录数超过阈值时，自动创建新的编号文档。
---

# error-notebook

## 目标
- 从对话历史中提取错误信息。
- 将错误条目以 Markdown 格式追加到统一文档，形成持续更新的错误日记。
- 识别重复修改超过3次的"顽疾"，并提供详细记录。

## 文件结构
```
skills/error-notebook/
  ├── SKILL.md
  ├── scripts/append_error.py
docs/
  ├── error-notebook-<项目名>.md         # 主错误笔记本
  ├── error-notebook-<项目名>-1.md       # 分割的错误笔记本（编号递增）
  ├── error-notebook-<项目名>-2.md       # 分割的错误笔记本（编号递增）
  └── ...
```

### 文档命名规则
- **主文档**：`error-notebook-<项目名>.md`，其中 `<项目名>` 自动从当前工作目录提取
- **分割文档**：当主文档记录数超过 100 时，自动创建编号递增的文档
- **项目名处理**：自动转换为小写，去除特殊字符，确保文件名安全

## 工作流程
1. 读取历史 → 获取对话内容。  
2. 识别错误 → 分类为推理 / 技术 / 表述 / 环境。  
3. 检查修改次数 → 跟踪错误的修改历史，计算修改次数（跨所有相关文档）。  
4. 生成条目 → 
   - 普通问题：必含字段：时间戳、错误类型、片段、描述、改进建议、任务背景。  
   - 顽疾（修改次数≥3）：在普通问题基础上，添加修改次数、失败的尝试、成功方法。  
5. 文档管理 → 调用 `scripts/append_error.py`：
   - 自动提取项目名，确定目标文档
   - 检查当前文档记录数
   - 当记录数超过 100 时，自动创建新的编号文档
   - 将错误条目追加到适当的文档
6. 去重处理 → 脚本检查是否存在完全相同的错误条目，避免重复记录。  
7. 跨文件查询 → 修改次数计算会遍历所有相关文档，确保统计准确。  

## 条目示例

### 普通问题示例
```markdown
## 2026-01-27 17:05:12
- [错误类型] 技术错误  
  片段: "遗漏了文件追加逻辑"  
  描述: 没有说明如何使用追加模式  
  改进建议: 使用 a+ 模式写入文件  
  任务背景: 用户要求实现文件追加功能，但代码中缺少具体实现逻辑  
```

### 顽疾示例
```markdown
## 2026-01-27 17:05:12
- [错误类型] 技术错误 [顽疾]  
  片段: "header和div之间有无法选中的容器"  
  描述: 多次尝试修复header和div之间的视觉分层问题失败  
  改进建议: 当遇到fixed定位导致的视觉问题时，考虑改为relative定位并移除相关的padding预留空间  
  任务背景: 用户多次反馈header和div之间有无法选中的容器，看起来像是导航栏被增高了  
  修改次数: 4  
  失败的尝试: 修改背景色 | 调整内外边距 | 优化CSS样式  
  成功方法: 将Header定位改为relative并移除main元素的padding-top  
```

## 运行频率
- 每次任务结束或每日定时运行。

---