# error-fix · Minimal Necessary Context (MNC)

本规则定义 `error-fix` 技能在执行前必须提取的最小必要上下文，确保诊断可执行、可验证、无冗余。

---

## 0. 触发条件（必须）
当出现以下任一情况时执行 MNC：
- 用户报告错误  
- AI IDE 执行报错  
- 输出异常或结果不符合预期  

禁止在无错误迹象时提取上下文。

---

## 1. 必须提取的上下文（最小必要性）

### 1.1 错误本体（必需）
- 错误信息（error message）  
- 堆栈摘要（stack trace）  
- 报错文件与行号  

用途：用于初判错误类型。

---

### 1.2 相关代码（必需）
仅提取与错误直接相关的最小范围：
- 报错行上下文（±10 行）  
- 涉及的函数 / 模块  
- 涉及的配置项（若错误指向配置）  

禁止提取整个文件。

---

### 1.3 输入与触发条件（必需）
- 触发错误的输入参数  
- 用户操作步骤  
- 请求体 / 响应体（若为网络错误）  

---

### 1.4 环境信息（按需）
仅在错误类型可能相关时提取：
- 运行时版本  
- 相关依赖版本  
- 环境变量（与错误相关）  
- 权限 / 路径 / 资源状态（若为系统错误）  

禁止提取完整环境。

---

### 1.5 最近变更（按需）
仅在错误可能由变更引起时提取：
- 与错误相关的最近修改文件  
- 与错误相关的 diff  

禁止扫描整个 Git 历史。

---

### 1.6 预期行为（必需）
- 用户期望的正确结果  
- 代码注释或文档中的预期逻辑  

用于判断逻辑错误。

---

## 2. 错误类型 → 必要上下文映射（最小必要性）

- **语法错误**：错误本体 + 相关代码  
- **运行时错误**：错误本体 + 相关代码 + 输入 + 环境  
- **逻辑错误**：相关代码 + 输入 + 预期行为  
- **网络错误**：错误本体 + 请求/响应 + 配置 + 环境  
- **系统错误**：错误本体 + 权限/路径/资源 + 环境  

禁止提取映射之外的上下文。

---

## 3. MNC 输出格式（必须）

```
【错误类型初判】
- <语法 / 运行时 / 逻辑 / 网络 / 系统>

【错误本体】
- <错误信息>
- <堆栈摘要>

【相关代码】
- <最小代码片段>

【触发条件】
- <输入 / 操作步骤>

【环境信息】
- <必要项>

【最近变更】
- <若无则写“无”>

【预期行为】
- <预期逻辑>

【缺失信息】
- <若无则写“无”>
```

---

## 4. MNC → 排查流程（逻辑闭环）

1. **根据 MNC 判断错误类型**  
2. **按类型选择排查方法组合**  
3. **执行修复**  
4. **测试验证**  

禁止跳过任意步骤。

---

## 5. 禁止事项（强约束）

- 禁止虚构上下文  
- 禁止过度提取（整个文件、整个环境、整个 Git 历史）  
- 禁止在未完成 MNC 前进入排查  
- 禁止使用推测替代实际上下文  

---
```

---